#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint-staged for staged files
npx lint-staged

# Check for markdown files in root (except allowed ones)
ROOT_MD_FILES=$(git diff --cached --name-only --diff-filter=A | grep -E '^[^/]+\.md$' | grep -vE '^(README|QUICK_START|QUICK_REFERENCE)\.md$' || true)

if [ -n "$ROOT_MD_FILES" ]; then
  echo "❌ Error: Cannot commit markdown files to root directory"
  echo "Allowed files: README.md, QUICK_START.md, QUICK_REFERENCE.md"
  echo "Found files:"
  echo "$ROOT_MD_FILES"
  echo ""
  echo "Please move these files to the appropriate docs/ subdirectory:"
  echo "  - Migration docs → docs/migrations/"
  echo "  - Guides → docs/guides/"
  echo "  - API docs → docs/api/"
  echo "  - Reference → docs/reference/"
  echo "  - Changelog → docs/changelog/"
  echo ""
  echo "Or run: pnpm organize-docs"
  exit 1
fi
