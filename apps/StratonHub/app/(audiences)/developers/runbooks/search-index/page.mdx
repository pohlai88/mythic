---
title: Search Index Pipeline
description: How to build and deploy the search index
audience: developers
type: how-to
published: true
last_updated: 2026-01-13
---

# Search Index Pipeline

> Build, validate, and deploy the StratonHub search index.

## Purpose

The search index enables the Command Palette (`Cmd+K`) and search API to find
documentation. This runbook covers:

1. How the index is built
2. When to rebuild
3. How to troubleshoot failures

## Prerequisites

- Node.js 20.11+ installed
- pnpm 8.15+ installed
- Working directory: `apps/StratonHub`

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MDX Files                                               â”‚
â”‚ app/(audiences)/**/*.mdx                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Index Builder                                           â”‚
â”‚ lib/search/index-builder.ts                             â”‚
â”‚ - Extracts frontmatter (YAML)                           â”‚
â”‚ - Extracts content text                                 â”‚
â”‚ - Generates route from file path                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Search Index                                            â”‚
â”‚ public/search-index.json                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Runtime                                                 â”‚
â”‚ - CommandPalette loads index                            â”‚
â”‚ - Search API queries with Fuse.js                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Steps

### 1. Build the Index

```bash
cd apps/StratonHub
pnpm search:build-index
```

Expected output:

```
ðŸ” Building search index...

ðŸ“„ Found 15 documents to index
â±ï¸  Index building took 42ms

âœ… Search index built successfully!
   ðŸ“Š Indexed 15 documents
   ðŸ’¾ Saved to: public/search-index.json
   â±ï¸  Total time: 68ms

ðŸ“ˆ Index Statistics:
   ðŸ‘¥ Audiences: 3 (developers, users, business)
   ðŸ¢ Surfaces: 1 (boardroom)
   ðŸ“š Document Types: 4 (tutorial, how-to, reference, explanation)
```

### 2. Verify the Index

Check the index file exists and has content:

```bash
ls -la public/search-index.json
cat public/search-index.json | jq '. | length'
```

### 3. Test Search Locally

1. Start the dev server: `pnpm dev`
2. Open `http://localhost:3000`
3. Press `Cmd+K` to open Command Palette
4. Search for a known term (e.g., "BoardRoom")
5. Verify results appear

## Verification

| Check           | Expected       | Command                                            |
| --------------- | -------------- | -------------------------------------------------- |
| Index exists    | File present   | `ls public/search-index.json`                      |
| Index not empty | > 0 documents  | `cat public/search-index.json \| jq '. \| length'` |
| Search works    | Results return | Manual test with Cmd+K                             |

## Troubleshooting

### "No documents found to index"

**Cause**: No MDX files with valid frontmatter in `app/(audiences)/`

**Solution**:

1. Check MDX files exist: `find app -name "*.mdx"`
2. Verify frontmatter is valid YAML
3. Ensure required fields: `title`, `audience`, `type`

### "Skipping (non-canonical frontmatter)"

**Cause**: MDX file missing required frontmatter fields

**Solution**:

1. Check the file path in the warning
2. Add missing fields to frontmatter
3. Required: `title`, `audience` (developers/users/business), `type`
   (tutorial/how-to/reference/explanation)

### Search returns empty results

**Cause**: Index not generated or not deployed

**Solution**:

1. Check `public/search-index.json` exists
2. Rebuild: `pnpm search:build-index`
3. Restart dev server

### Index outdated after adding pages

**Cause**: Index not rebuilt after content changes

**Solution**:

1. Index is rebuilt automatically during `pnpm build`
2. For dev: manually run `pnpm search:build-index`

## Rollback

If the index is corrupted:

```bash
# Remove corrupted index
rm public/search-index.json

# Rebuild from scratch
pnpm search:build-index
```

## Automation

The index is built automatically:

- **CI/CD**: `pnpm build` runs `pnpm search:build-index` first
- **Pre-commit**: Consider adding to pre-commit hook for dev experience

## Files Referenced

| File                                 | Purpose             |
| ------------------------------------ | ------------------- |
| `scripts/build-search-index.ts`      | CLI entry point     |
| `lib/search/index-builder.ts`        | Core indexing logic |
| `lib/search/types.ts`                | TypeScript types    |
| `app/api/search/route.ts`            | Runtime search API  |
| `components/docs/CommandPalette.tsx` | Search UI           |

## Related

- [Getting Started](/developers/getting-started) â€” Development setup
- [Architecture](/developers/architecture) â€” System design
