---
description: "Root Configuration Governance - Enforces elite monorepo config patterns (Three Governing Rules)"
globs: "package.json,pnpm-workspace.yaml,turbo.json,tsconfig.json,next.config.*,tailwind.config.*,*.mjs,*.ts,apps/**/next.config.*,apps/**/tsconfig.json"
alwaysApply: false
priority: 15
---

# Root Configuration Governance (RFC-2119 MANDATORY)

**Authority**: Root Configuration Elite Management Guide v2.0.0
**Reference**: `@docs/architecture/ROOT_CONFIG_ELITE_MANAGEMENT.md`
**Status**: MANDATORY - Enforced via Cursor AI

---

## 1. Three Governing Rules (SEAL-READY)

### Rule 1: Root is Minimal and Monorepo-Only (MANDATORY)

**‚úÖ DO**:
- Root configs = Only monorepo-level configs
- App-specific configs = `apps/*/`
- Shared configs = `packages/config/`
- Maximum 10-15 root configs

**‚ùå FORBIDDEN**:
- ‚ùå `next.config.*` at root (MUST be in `apps/*/`)
- ‚ùå App-specific configs at root
- ‚ùå Duplicate configs across apps

**Enforcement**:
```typescript
// ‚ùå FORBIDDEN: Root next.config.mjs
// File: next.config.mjs (root)
// Action: REJECT - Move to apps/*/next.config.mjs

// ‚úÖ CORRECT: App-specific config
// File: apps/my-app/next.config.mjs
```

---

### Rule 2: All Shared Config Lives in `packages/config/*` (MANDATORY)

**‚úÖ DO**:
- Shared configs = `packages/config/*` packages
- TurboRepo tracks `packages/config/**/*.json` in globalDependencies
- Apps extend shared configs via workspace packages
- Versioned config packages (`@mythic/config-*`)

**‚ùå FORBIDDEN**:
- ‚ùå Duplicate configs across apps
- ‚ùå Shared configs at root (unless truly global)
- ‚ùå App-specific configs in `packages/config/`

**Enforcement**:
```json
// ‚úÖ CORRECT: turbo.json globalDependencies
{
  "globalDependencies": [
    "package.json",
    "pnpm-lock.yaml",
    "pnpm-workspace.yaml",
    "packages/config/**/*.json"  // ‚úÖ Shared configs only
  ],
  "tasks": {
    "build": {
      "inputs": [
        "next.config.mjs",    // ‚úÖ App-specific (not global)
        "tsconfig.json"      // ‚úÖ App-specific (not global)
      ]
    }
  }
}
```

---

### Rule 3: TypeScript Solution-Style References is Canonical (MANDATORY)

**‚úÖ DO**:
- Root `tsconfig.json` = Base config only (NO references)
- Each app/package = References only direct dependencies
- Prevents reference explosion at scale

**‚ùå FORBIDDEN**:
- ‚ùå References array in root `tsconfig.json` (at scale)
- ‚ùå Apps referencing all packages
- ‚ùå Circular references

**Enforcement**:
```json
// ‚úÖ CORRECT: Root tsconfig.json (base only)
{
  "compilerOptions": {
    "composite": true,
    "incremental": true
  }
  // ‚úÖ NO references array
}

// ‚úÖ CORRECT: App tsconfig.json (references only deps)
{
  "extends": "../../tsconfig.json",
  "references": [
    { "path": "../../packages/shared-utils" },
    { "path": "../../packages/domain-auth" }
  ]
}
```

---

## 2. Package Management Governance

### 2.1 pnpm-workspace.yaml is Canonical (MANDATORY)

**‚úÖ DO**:
- `pnpm-workspace.yaml` is single source of truth
- Keep it simple (just workspace paths)

**‚ùå FORBIDDEN**:
- ‚ùå `workspaces` field in root `package.json` (double-source-of-truth)
- ‚ùå Complex logic in `pnpm-workspace.yaml`

**Enforcement**:
```json
// ‚ùå FORBIDDEN: workspaces in package.json
{
  "workspaces": ["apps/*", "packages/*"]  // ‚ùå Remove this
}

// ‚úÖ CORRECT: Only pnpm-workspace.yaml
// pnpm-workspace.yaml:
packages:
  - "apps/*"
  - "packages/*"
```

---

### 2.2 Version Upgrade Policy (MANDATORY)

**When updating Node.js/pnpm versions**:

1. ‚úÖ Update `.node-version`, `.nvmrc`, `package.json` engines
2. ‚úÖ Update `packageManager` in `package.json`
3. ‚úÖ Run test gate: `pnpm -r build && pnpm -r lint && pnpm -r type-check`
4. ‚úÖ Document decision in ADR or decision ledger

**Enforcement**:
- ‚úÖ Check if version change requires test gate
- ‚úÖ Verify ADR/decision ledger entry exists
- ‚úÖ Ensure all version files updated consistently

---

## 3. TurboRepo Configuration Governance

### 3.1 Minimal Global Dependencies (MANDATORY)

**‚úÖ DO**:
- Only truly global configs in `globalDependencies`
- App-specific configs in task `inputs`

**Key Principle**:
- `globalDependencies` = Configs that affect ALL apps
- Task `inputs` = Configs that affect specific apps

**Enforcement**:
```json
// ‚úÖ CORRECT: Minimal globalDependencies
{
  "globalDependencies": [
    "package.json",              // ‚úÖ Affects all
    "pnpm-lock.yaml",            // ‚úÖ Affects all
    "pnpm-workspace.yaml",       // ‚úÖ Affects all
    "packages/config/**/*.json"   // ‚úÖ Shared configs only
  ],
  "tasks": {
    "build": {
      "inputs": [
        "next.config.mjs",    // ‚úÖ App-specific
        "tsconfig.json"        // ‚úÖ App-specific
      ]
    }
  }
}
```

---

## 4. TypeScript Configuration Governance

### 4.1 Solution-Style References (CANONICAL)

**‚úÖ DO**:
- Root `tsconfig.json` = Base config only (NO references)
- Apps reference only direct dependencies
- Prevents reference explosion

**Enforcement**:
- ‚úÖ Check root `tsconfig.json` has NO references array (at scale)
- ‚úÖ Verify apps reference only their dependencies
- ‚úÖ Prevent circular references

---

## 5. Styling Configuration Governance

### 5.1 Design System Constitution (MANDATORY)

**‚ö†Ô∏è DEPRECATED**: This section is superseded by `033_design-system-constitution.mdc`

**Design System Constitution is the ONLY source of truth:**
- See `033_design-system-constitution.mdc` for ALL styling rules
- Tailwind CSS v4 uses CSS-first configuration (`@theme` directive)
- Config files are optional in Tailwind v4 (use `@source` directives)
- Design system package is sealed and authoritative
- All styling MUST follow design system constitution

**Reference:**
- `033_design-system-constitution.mdc` - Complete design system rules
- `packages/design-system/` - Design system package (sealed)

---

## 6. Package Boundary Enforcement

### 6.1 Cross-Domain Import Rules (MANDATORY)

**‚úÖ DO**:
- Use `@mythic/shared-types` as bridge between domains
- Apps import from shared packages only

**‚ùå FORBIDDEN**:
- ‚ùå Cross-domain imports (`@mythic/domain-*` from other domains)
- ‚ùå App-to-app imports
- ‚ùå Direct domain package imports in RFL

**Enforcement**:
```typescript
// ‚ùå FORBIDDEN: Cross-domain import
import { Invoice } from '@mythic/domain-finance'
// In domain-procurement/rfl/store.ts

// ‚úÖ CORRECT: Use shared-types bridge
import { Invoice } from '@mythic/shared-types'
// In domain-procurement/rfl/store.ts
```

---

## 7. Cursor Governance Configuration

### 7.1 .cursorignore as First-Class Config (MANDATORY)

**‚úÖ DO**:
- Exclude build artifacts from AI context
- Preserve planning zones (`.cursor/planing`, `.cursor/product`)
- Archive historical docs (`.cursor/archive/`)

**Enforcement**:
- ‚úÖ Verify `.cursorignore` excludes build artifacts
- ‚úÖ Preserve zones are documented
- ‚úÖ AI context is focused on active code

---

### 7.2 Cursor Documentation Hierarchy (MANDATORY)

**‚úÖ DO**:
- `.cursor/docs/` = Canonical reference (AI reads)
- `.cursor/planing/` = Preserved zone (immutable)
- `.cursor/product/` = Preserved zone (immutable)
- `.cursor/archive/` = Historical (excluded from AI)

**Enforcement**:
- ‚úÖ Verify documentation hierarchy is respected
- ‚úÖ Preserved zones are not modified by AI
- ‚úÖ Canonical references are in `.cursor/docs/`

---

## 8. Validation Checklist

### When Creating/Modifying Root Configs:

- [ ] ‚úÖ Is this config truly monorepo-level?
- [ ] ‚úÖ Is this config app-specific? (If yes, move to `apps/*/`)
- [ ] ‚úÖ Is this config shared? (If yes, move to `packages/config/`)
- [ ] ‚úÖ Does `pnpm-workspace.yaml` match workspace structure?
- [ ] ‚úÖ Are `globalDependencies` minimal (only truly global)?
- [ ] ‚úÖ Are app-specific configs in task `inputs`?
- [ ] ‚úÖ Does root `tsconfig.json` have NO references? (at scale)
- [ ] ‚úÖ Do apps reference only their dependencies?
- [ ] ‚úÖ Is Tailwind config in design system package?
- [ ] ‚úÖ Are package boundaries respected?

---

## 9. Enforcement Actions

### Automatic Enforcement:

1. **Root Config Creation**:
   - ‚úÖ Check if config is app-specific ‚Üí REJECT (move to `apps/*/`)
   - ‚úÖ Check if config is shared ‚Üí REJECT (move to `packages/config/`)
   - ‚úÖ Verify config is truly monorepo-level

2. **Package.json Modification**:
   - ‚úÖ Check for `workspaces` field ‚Üí WARN (remove, use pnpm-workspace.yaml)
   - ‚úÖ Verify `packageManager` is pinned
   - ‚úÖ Verify `engines` match `.node-version` and `.nvmrc`

3. **Turbo.json Modification**:
   - ‚úÖ Check `globalDependencies` are minimal
   - ‚úÖ Verify app-specific configs are in task `inputs`
   - ‚úÖ Verify `packages/config/**/*.json` is tracked

4. **TypeScript Config Modification**:
   - ‚úÖ Check root `tsconfig.json` has NO references (at scale)
   - ‚úÖ Verify apps reference only their dependencies
   - ‚úÖ Prevent circular references

5. **Next.js Config Creation**:
   - ‚úÖ REJECT if at root (must be in `apps/*/`)
   - ‚úÖ Verify app-specific optimizations

---

## 10. Quick Reference

### ‚úÖ Root Configs CAN:
- Be monorepo-level only
- Track shared configs in `packages/config/`
- Use minimal `globalDependencies`
- Have base-only TypeScript config (no references at scale)

### ‚ùå Root Configs CANNOT:
- Include app-specific configs (`next.config.*`, app-specific `tsconfig.json`)
- Include `workspaces` field in `package.json`
- Have references array in root `tsconfig.json` (at scale)
- Duplicate shared configs

### üìã Required Patterns:
- `pnpm-workspace.yaml` = Single source of truth
- `packages/config/*` = Shared configs
- `apps/*/next.config.mjs` = App-specific Next.js config
- Root `tsconfig.json` = Base only (no references at scale)

---

## 11. References

- **Root Config Guide**: `@docs/architecture/ROOT_CONFIG_ELITE_MANAGEMENT.md`
- **Monorepo Best Practices**: `@docs/architecture/MONOREPO_BEST_PRACTICES.md`
- **RFL Doctrine**: `@.cursor/rules/025_rfl-doctrine-enforcement.mdc`
- **Package Boundary Rules**: See Root Config Guide Section 10

---

**Status**: MANDATORY - Enforced via Cursor AI
**Version**: 1.0.0
**Effective Date**: 2026-01-11
**Authority**: Root Configuration Elite Management Guide v2.0.0
